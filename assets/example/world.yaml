world:
  title: Misty Trial
  start: crossroad
  initial_companions:
    - lenny
  initial_inventory:
    - lint

ai_guidance:
  text_generation: The tone should be quirky, non-serious and off-beat.
  image_generation: vibrant, warm tones, fantasy storybook style.

flags:
  - gate_unlocked

items:
  brass_key:
    name: Brass Key
    description: A tarnished brass key that feels heavy and important.
    location_description: A tarnished brass key lies half-buried in the moss.
    portable: true
    aliases:
      - key
  stone_gate:
    name: Stone Gate
    description: A mossy stone gate with an ancient lock.
    portable: false
    aliases:
      - gate
  survey_map:
    name: Survey Map
    description: A charcoal map showing the outer ruins.
    location_description: A charcoal map is tucked under a loose stone.
    portable: true
    aliases:
      - map
      - chart
  small_hut:
    name: Small Hut
    description: A simple but well kept coblestone hut with a dirt floor and a thached roof.
    portable: false
    aliases:
      - small cobblestone hut
      - cobblestone hut
      - hut
  hermit:
    name: Hermit
    description: A slender wirey old man with gray hair.
    location_description: A stooped hermit tends a tiny fire, watching you warily.        
  gnome:
    name: Gnome
    description: A short, grumpy looking gnome.
    location_description: A short, grumpy looking gnome sits on a mossy rock.
  lenny:
    name: Lenny the Leprechaun
    description: A small, annoyingly jolly leprechaun who follows you around. He claims to be your leprechaun equivalent of a fairy godmother, yet has no interest in doing anything helpful. There doesn't seem to be any way to get rid of him.
    aliases:
      - lenny
      - leprechaun
  lint:
    name: Pocket lint
    description: A small pile of fluff that has gathered in your pocket. Why is lint always purple?
    portable: true
    aliases:
      - lint
      - fluff

locations:
  crossroad:
    name: Crossroad
    description: Trails converge beneath leaning pines, with mist clinging to the ground.
    exits:
      north:
        to: forest_path
        description: A narrow path under the canopy.
      east:
        to: stone_gate_clearing
        description: Stones hinting at old ruins.
    items: []
  forest_path:
    name: Forest Path
    description: The trees press close and the air smells of damp bark.
    exits:
      south:
        to: crossroad
        description: Back toward the crossroads.
      west:
        to: small_hut
        description: A narrow path climbs up a grassy slope.
    items:
      - brass_key
  small_hut:
    name: Small Hut
    description: The trail ends at a small cobblestone hut.
    exits:
      east:
        to: forest_path
        description: Back down the forest path.
    items:
      - small_hut
      - hermit
  stone_gate_clearing:
    name: Stone Gate Clearing
    description: A low wall and a sealed gate block the way north.
    exits:
      west:
        to: crossroad
        description: Toward the crossroads.
      north:
        to: inner_courtyard
        description: Through the stone gate.
        criteria:
          requires_flags:
            - gate_unlocked
        blocked_description: The gate is locked tight.
    items:
      - stone_gate
      - gnome
  inner_courtyard:
    name: Inner Courtyard
    description: Ruined walls encircle a quiet courtyard lit by pale light.
    exits:
      south:
        to: stone_gate_clearing
        description: Back to the gate.
    items:
      - survey_map

npcs:
  hermit:    
    persona: Wry, terse, likes riddles about the forest; guarded but not hostile.
    sample_lines:
      - "Hush now, the woods listen more than you think."
      - "Every lock has a story; some open only to those who listen."
    quest_hook: Knows rumors about the stone gate; will hint if asked or befriended.
    dialog: The hermit eyes you, then mutters about an old key lost along the forest path.
  gnome:
    persona: Cheeky, unhelpful and somewhat sarcastic; but not threatening.
    sample_lines:
      - "Sure, sure. Everyone has a story."
      - "And why would I want to do that?"
    dialog: 
      - criteria: { blocking_flags: [ gate_unlocked ] }
        npc_narrative: The gnome turns towards you lazily. "Don't look at me, I aint opening this gate for anybody."
        responses:
          ok:
            keyword_hint: shrug and say *OK*
            player_narrative: >
              "Fine. I'll do it myself."
            npc_narrative: The gnome snorts, uninterested.
          reward:
            keyword_hint: offer a *reward*
            aliases:
              - offer reward
            player_narrative: >
              "What about for a reward? I have a lovely pile of purple pocket lint here."
            criteria:
              requires_inventory: [ lint ]              
            npc_narrative: 
              - text: The gnome scratches his chin. "I aint got no use for lint. But that shiney key there..."
                criteria:
                  requires_inventory: [ brass_key ]
              - text: The gnome turns away, unimpressed.
          psychology:
            keyword_hint: try some *psychology*
            aliases:
              - psych
            player_narrative: >
              "Hey, don't sweat it. Big gate, small gnome - nothing to be ashamed of."
            npc_narrative: >
              The gnome looks affronted. "Size isn't everything, you big galoot!".
              Sliding off the stone, he hobbles over to the gate gives it a calculated kick.
              To your surprise the gate unlocks with a loud clunk and swings open.
            effect:
              set_flags: [ gate_unlocked ]
      - text: >
          "Seeing as you don't need that key anymore..."
        criteria:
          requires_inventory:
            - brass_key
      - >
        "Hrmph! Why are you still bothering me?"
      
  lenny:
    persona: Annoyingly jolly and enthusiastic; eager to share his opinion.
    sample_lines:
      - This reminds me of a time a wizard turned me into a jellyfish.
      - Ooh I love grumpy trolls. Try poking it with a stick.
      - I'd love to carry that for you, but I don't want to.
    dialog: 
      - text: >
          "Gotta admit, I didn't think you'd solve the gate puzzle."
        criteria:
          requires_flags: [ 'gate_unlocked' ]
      - Lenny says "You're doing well! Much better than the last guy!"            

interactions:
  unlock_stone_gate:
    verb: use
    item: brass_key
    target: stone_gate
    effect:
      set_flags:
        - gate_unlocked
    consumes: false
    message: The brass key turns; stone grinds and the gate unlocks and swings open.
  try_open_stone_gate_locked:
    verb: open
    item: stone_gate
    criteria:
      blocking_flags:
        - gate_unlocked
    repeatable: true
    message: The gate is locked and won't open.
  try_open_stone_gate_already_open:
    verb: open
    item: stone_gate
    criteria:
      requires_flags:
        - gate_unlocked
    repeatable: true
    message: It's already open.
  give_lint_to_lenny:
    verb: give
    item: lint
    target: lenny
    repeatable: false
    message: The leprechaun's eyes widen. "You have given me pocket lint! The spell is broken! I am free! ...I'm just kidding, here's your stinky fluff back. Who gives someone lint?"
  give_lint_to_gnome:
    verb: give
    item: lint
    target: gnome
    repeatable: false
    message: The gnome is not impressed with your pocket fluff.
  give_key_to_gnome:
    verb: give
    item: brass_key
    target: gnome
    repeatable: false
    consumes: true
    effect:
      set_flags:
        - gate_unlocked
    message:
      - text: >
          The gnome's eyes light up. "Hoo! This is the one! How you separated this from that meddlesome old gaffer I don't know. Well, a deal's a deal."
          He shuffles over to the gate and unlocks it with a loud clunk. It swings open, revealing the path northward.
        criteria:
          blocking_flags:
            - gate_unlocked
      - text: The gnome accepts it grudgingly, but you detect a spark in his eye. "I suppose you won't be needing it anyway.."
